<!DOCTYPE html>
<html>

<head>
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>

<body>
    <p>This add-in will insert the text 'Hello world!' 57 in a new message.</p>

    <script>
        Office.onReady((info) => {
            if (info.host === Office.HostType.Outlook) {
                // Stelle sicher, dass die Funktion direkt aufgerufen wird, nachdem Office.onReady ausgelöst wurde
                sayHello();
            }
        });

        /**
         * Writes 'Hello world!' to a new message body.
         */
        function sayHello() {
            // Zugriff auf die Empfängerinformationen im to-Eigenschaftsobjekt
            var recipients = Office.context.mailbox.item.to;

            // Überprüfe die Empfängerinformationen, indem du sie in die Konsole schreibst
            console.log("Recipients:", recipients);

            // Überprüfe, ob Empfänger vorhanden sind, bevor du darauf zugreifst
            if (recipients && recipients.length > 0) {
                // Wähle den ersten Empfänger aus (du könntest hier eine Schleife verwenden, um alle Empfänger zu durchlaufen)
                var firstRecipient = recipients[0];

                // Greife auf verschiedene Eigenschaften des Empfängers zu
                var recipientDisplayName = firstRecipient.displayName;
                var recipientEmailAddress = firstRecipient.emailAddress;

                // Setze den Text in den E-Mail-Body
                Office.context.mailbox.item.body.setAsync(
                    `Hello ${recipientDisplayName},<br><br><br><br> Best,<br>Sender`,
                    {
                        coercionType: "html", // Schreibe den Text als HTML
                    },
                    // Rückrufmethode, um zu überprüfen, dass setAsync erfolgreich war
                    function (asyncResult) {
                        if (asyncResult.status == Office.AsyncResultStatus.Failed) {
                            console.error(asyncResult.error.message);
                        }
                    }
                );
            } else {
                console.error("Keine Empfänger gefunden.");
            }
        }
    </script>
</body>

</html>

<!DOCTYPE html>
<html>

<head>
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>

<body>
    <p>This add-in will insert the text 'Hello world!' 26 in a new message.</p>

</body>

<script>

    Office.onReady((info) => {
        if (info.host === Office.HostType.Outlook) {
            // Rufen Sie die Funktion direkt auf, um sie automatisch auszuführen
            extractAndInsertName();
        }
    });

    /**
     * Writes 'Hello world!' to a new message body and extracts sender's first and last name.
     */
    function extractAndInsertName() {
        // Holen Sie sich die Absenderinformationen
        var sender = Office.context.mailbox.item.sender;

        // Überprüfen Sie, ob der Absender vorhanden ist und eine E-Mail-Adresse hat
        if (sender && sender.emailAddress) {
            // Extrahieren Sie den Vornamen und Nachnamen aus der E-Mail-Adresse
            var emailParts = sender.emailAddress.split('@')[0].split('.');
            var firstName = emailParts[0];
            var lastName = emailParts[1];

            // Fügen Sie den extrahierten Namen in den E-Mail-Body ein
            var greeting = Office.context.mailbox.item.sender;
            //var greeting = "Hello " + firstName + " " + lastName + ",<p><p><p><p> Best, <p><p> Sender";

            Office.context.mailbox.item.body.setAsync(
                greeting,
                {
                    coercionType: "html", // Write text as HTML
                },
                // Callback method to check that setAsync succeeded
                function (asyncResult) {
                    if (asyncResult.status ==
                        Office.AsyncResultStatus.Failed) {
                        write(asyncResult.error.message);
                    }
                }
            );
        } else {
            console.error("Absenderinformationen konnten nicht abgerufen werden.");
        }
    }

</script>
</html>

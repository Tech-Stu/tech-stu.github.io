<!DOCTYPE html>
<html>

<head>
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>

<body>
    <p>This add-in will insert the text 'Hello world!' 38x in a new message.</p>

</body>

<script>

    Office.onReady((info) => {
        if (info.host === Office.HostType.Outlook) {
            // Rufen Sie die Funktion direkt auf, um sie automatisch auszuführen
            extractAndInsertSender();
        }
    });

    /**
     * Writes 'Hello world!' to a new message body and extracts sender's email address.
     */
    function extractAndInsertSender() {
        // Holen Sie sich die Absenderinformationen
        var sender = Office.context.mailbox.item.sender;

        // Überprüfen Sie, ob der Absender vorhanden ist und eine E-Mail-Adresse hat
        if (sender && sender.emailAddress) {
            // Fügen Sie die Absenderadresse in den E-Mail-Body ein
            var greeting = "Hello Recipient,<br><br><br><br> Best,<br>Sender: " + sender.emailAddress;

            // Abonnieren Sie das ItemCompose-Ereignis
            Office.context.mailbox.addHandlerAsync(Office.EventType.ItemCompose, {}, function (asyncResult) {
                if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
                    // Callback-Methode zum Überprüfen des erfolgreichen Hinzufügens des Handlers
                    Office.context.mailbox.item.body.setAsync(
                        greeting,
                        {
                            coercionType: "html", // Write text as HTML
                        },
                        // Callback-Methode zum Überprüfen des erfolgreichen Setzens des E-Mail-Body
                        function (asyncResult) {
                            if (asyncResult.status === Office.AsyncResultStatus.Failed) {
                                write(asyncResult.error.message);
                            }
                        }
                    );
                } else {
                    console.error("Fehler beim Hinzufügen des Handlers:", asyncResult.error.message);
                }
            });
        } else {
            console.error("Absenderinformationen konnten nicht abgerufen werden.");
        }
    }

</script>
</html>
